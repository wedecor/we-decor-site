const cloudinary = require('cloudinary').v2;
const fs = require('fs');
const path = require('path');

cloudinary.config({
  cloud_name: 'dux3m2saz',
  api_key: '669972431736695',
  api_secret: 'Hm3UY3-q0MhLfgPeOrLhps_Gl3c',
});

const outputPath = path.join(__dirname, '../utils/gallery.ts');

async function fetchAllImages() {
  let nextCursor = undefined;
  const resources = [];
  do {
    const result = await cloudinary.search
      .expression('folder:we-decor/*')
      .max_results(500)
      .next_cursor(nextCursor)
      .execute();
    resources.push(...result.resources);
    nextCursor = result.next_cursor;
  } while (nextCursor);
  return resources;
}

function toAltText(filename) {
  return filename
    .replace(/[-_]/g, ' ')
    .replace(/\.[^/.]+$/, '')
    .replace(/\s+/g, ' ')
    .replace(/\b\w/g, c => c.toUpperCase());
}

(async () => {
  const images = await fetchAllImages();
  const galleryMap = {};
  images.forEach(img => {
    if (!img.folder || !img.folder.startsWith('we-decor/')) return; // skip images without a valid folder
    const folder = img.folder.replace('we-decor/', '');
    if (!galleryMap[folder]) galleryMap[folder] = [];
    galleryMap[folder].push({
      src: img.secure_url,
      alt: toAltText(path.basename(img.secure_url)),
    });
  });
  const fileContent =
    '// AUTO-GENERATED BY generate-cloudinary-gallery-map.js\n' +
    'const gallery = ' + JSON.stringify(galleryMap, null, 2) + ';\n\nexport default gallery;\n';
  fs.writeFileSync(outputPath, fileContent);
  console.log('Gallery mapping generated at utils/gallery.ts');
})(); 